Pass1
Pass2
      1                        0319    LINE_COUNTER2 EQU $0319
      2                        0006    COLOR_BG    EQU $6
      3
      4                        0800    NB_LINES    EQU $800
      5                        0801    NB_VECTORS  EQU $801
      6                        0802    SCAN_LINE   EQU $802
      7                        0803    COLOR       EQU $803
      8                        0804    CNT         EQU $804
      9                        0805    REG0        EQU $805
     10                        0806    REG1        EQU $806
     11                        0807    TOP_LINE    EQU $807
     12                        0808    LINE_COUNTER EQU $808
     13                        0809    DX          EQU $809
     14                        080A    X_START     EQU $80A
     15                        080B    CMD         EQU $80B
     16
     17        0000                        ORG $0000
     18                        F0          SETDP $F0
     19
     20  2     0000    86 F0               LDA #$F0
     21  8     0002    1E 8B               EXG A,DP
     22
     23        0004                    WAIT_VIDEO_CHIP
     24  4     0004    96 00               LDA $F000
     25  2     0006    84 04               ANDA #4
     26  3     0008    27 FA               BEQ WAIT_VIDEO_CHIP
     27
     28  6     000A    0F 10               CLR $F010
     29
     30        000C                    WAIT_VIDEO_CHIP2
     31  4     000C    96 00               LDA $F000
     32  2     000E    84 04               ANDA #4
     33  3     0010    27 FA               BEQ WAIT_VIDEO_CHIP2
     34
     35  7     0012    8D 46               BSR CLEAR_SCREEN
     36  2     0014    C6 20               LDB #$20
     37  7     0016    8D 51               BSR DRAW_BACKGROUND_LINE
     38  2     0018    C6 50               LDB #$50
     39  7     001A    8D 4D               BSR DRAW_BACKGROUND_LINE
     40  2     001C    C6 70               LDB #$70
     41  7     001E    8D 49               BSR DRAW_BACKGROUND_LINE
     42  2     0020    C6 80               LDB #$80
     43  7     0022    8D 45               BSR DRAW_BACKGROUND_LINE
     44
     45  2     0024    86 59               LDA #89
     46  5     0026    B7 080A             STA X_START
     47  2     0029    86 17               LDA #$17
     48  5     002B    B7 080B             STA CMD
     49  8     002E    BD 0086             JSR DRAW_BACKGROUND_LINE2
     50
     51  2     0031    86 AB               LDA #171
     52  5     0033    B7 080A             STA X_START
     53  2     0036    86 15               LDA #$15
     54  5     0038    B7 080B             STA CMD
     55  7     003B    8D 49               BSR DRAW_BACKGROUND_LINE2
     56
     57  2     003D    86 FF               LDA #$FF
     58  5     003F    B7 0807             STA TOP_LINE
     59  2     0042    86 90               LDA #$90
     60  5     0044    B7 0808             STA LINE_COUNTER
     61
     62        0047                    DEBUT
     63  8     0047    BD 00A9             JSR DRAW_BITMAP
     64  7     004A    7A 0807             DEC TOP_LINE
     65  7     004D    7A 0808             DEC LINE_COUNTER
     66  7     0050    7A 0807             DEC TOP_LINE
     67  7     0053    7A 0808             DEC LINE_COUNTER
     68  3     0056    26 EF               BNE DEBUT
     69
     70        0058                    END_PRG
     71  3     0058    20 FE               BRA END_PRG
     72
     73                                ********************************************************************************
     74
     75        005A                    CLEAR_SCREEN
     76        005A                    WAIT_VIDEO_CHIP_CS                  * WAIT_EF9365_READY();
     77  4     005A    96 00               LDA $F000
     78  2     005C    84 04               ANDA #4
     79  3     005E    27 FA               BEQ WAIT_VIDEO_CHIP_CS
     80
     81  2     0060    C6 04               LDB #$4
     82  4     0062  108E F000             LDY #$F000
     83  4+0   0066    E7 A4           	STB ,Y
     84  5     0068    39                  RTS
     85
     86                                ********************************************************************************
     87
     88        0069                    DRAW_BACKGROUND_LINE
     89        0069                    WAIT_VIDEO_CHIP_BG1                  * WAIT_EF9365_READY();
     90  4     0069    96 00               LDA $F000
     91  2     006B    84 04               ANDA #4
     92  3     006D    27 FA               BEQ WAIT_VIDEO_CHIP_BG1
     93
     94  6     006F    0F 08               CLR $F008   * ? = 0
     95  6     0071    0F 09               CLR $F009   * X = 0
     96  6     0073    0F 0A               CLR $F00A   * ? = 0
     97  4     0075    D7 0B               STB $F00B   * Y = B
     98  2     0077    86 FF               LDA #$FF
     99  4     0079    97 05               STA $F005   * dX = 255
    100  2     007B    86 06               LDA #COLOR_BG
    101  4     007D    97 10               STA $F010   * color
    102  6     007F    0F 07               CLR $F007   * dY = 0
    103  2     0081    86 11               LDA #$11
    104  4     0083    97 00               STA $F000   * CMD = draw_line
    105  5     0085    39                  RTS
    106
    107                                ********************************************************************************
    108
    109        0086                    DRAW_BACKGROUND_LINE2
    110        0086                    WAIT_VIDEO_CHIP_BG2                  * WAIT_EF9365_READY();
    111  4     0086    96 00               LDA $F000
    112  2     0088    84 04               ANDA #4
    113  3     008A    27 FA               BEQ WAIT_VIDEO_CHIP_BG2
    114
    115  5     008C    B6 080A             LDA X_START
    116  4     008F    97 09               STA $F009   * X = X_START
    117  6     0091    0F 08               CLR $F008   * ? = 0
    118  6     0093    0F 0A               CLR $F00A   * ? = 0
    119  4     0095    D7 0B               STB $F00B   * Y = B
    120  2     0097    86 1E               LDA #30
    121  4     0099    97 05               STA $F005   * dX
    122  2     009B    86 06               LDA #COLOR_BG
    123  4     009D    97 10               STA $F010   * color
    124  2     009F    86 80               LDA #$80
    125  4     00A1    97 07               STA $F007   * dY
    126  5     00A3    B6 080B             LDA CMD
    127  4     00A6    97 00               STA $F000   * CMD = draw_line
    128  5     00A8    39                  RTS
    129
    130                                ********************************************************************************
    131
    132        00A9                    DRAW_BITMAP
    133  3     00A9    8E 0137             LDX #BITMAP
    134
    135  4+0   00AC    E6 84               LDB ,X                      * i = nb_lines
    136  4+2   00AE    A6 80               LDA ,X+                    * nb_lines = *vectorized_sprite++;
    137  5     00B0    B7 0800             STA NB_LINES
    138
    139        00B3                    WAIT_VIDEO_CHIP_B1                  * WAIT_EF9365_READY();
    140  4     00B3    96 00               LDA $F000
    141  2     00B5    84 04               ANDA #4
    142  3     00B7    27 FA               BEQ WAIT_VIDEO_CHIP_B1
    143
    144  6     00B9    0F 07               CLR $F007                       * WR_BYTE(HW_EF9365 + 0x7, 0x00);
    145
    146  5     00BB    B6 0807             LDA TOP_LINE
    147  5     00BE    B7 0802             STA SCAN_LINE                   * regsbuf[1] = 100
    148
    149        00C1                    DRAW_BITMAP_LOOP
    150
    151        00C1                    WAIT_VIDEO_CHIP_B2                  * WAIT_EF9365_READY();
    152  4     00C1    96 00               LDA $F000
    153  2     00C3    84 04               ANDA #4
    154  3     00C5    27 FA               BEQ WAIT_VIDEO_CHIP_B2
    155
    156  6     00C7    0F 08               CLR $F008
    157  6     00C9    0F 0A               CLR $F00A
    158  2     00CB    86 5A               LDA #90
    159  4     00CD    97 09               STA $F009
    160  5     00CF    B6 0802             LDA SCAN_LINE
    161  4     00D2    97 0B               STA $F00B
    162
    163  4+2   00D4    A6 80               LDA ,X+                    * nb_vects = *vectorized_sprite++;
    164  5     00D6    B7 0801             STA NB_VECTORS
    165
    166        00D9                    DRAW_LINE_LOOP
    167  4+2   00D9    A6 80               LDA ,X+
    168  5     00DB    B7 0803             STA COLOR
    169  2     00DE    44                  LSRA
    170  2     00DF    44                  LSRA
    171  2     00E0    44                  LSRA
    172  2     00E1    44                  LSRA
    173  5     00E2    B7 0804             STA CNT
    174  2     00E5    81 00               CMPA #0
    175  3     00E7    26 07               BNE DRAW_LINE1                  * if (cnt == NULL)
    176  4+2   00E9    A6 80               LDA ,X+                    * regsbuf[0] = *vectorized_sprite++;
    177  5     00EB    B7 0805             STA REG0
    178  3     00EE    20 03               BRA DRAW_VECTOR
    179        00F0                    DRAW_LINE1
    180  5     00F0    B7 0805             STA REG0                        * regsbuf[0] = cnt;
    181        00F3                    DRAW_VECTOR
    182  5     00F3    B6 0803             LDA COLOR
    183  2     00F6    84 0F               ANDA #$0F
    184  5     00F8    B7 0806             STA REG1
    185  2     00FB    81 07               CMPA #$07
    186  3     00FD    26 16               BNE WAIT_VIDEO_CHIP_B3
    187  5     00FF    B6 0802             LDA SCAN_LINE
    188  2     0102    81 50               CMPA #$50
    189  3     0104    27 0A               BEQ BACKGROUND_COLOR
    190  2     0106    81 70               CMPA #$70
    191  3     0108    27 06               BEQ BACKGROUND_COLOR
    192  2     010A    81 80               CMPA #$80
    193  3     010C    27 02               BEQ BACKGROUND_COLOR
    194  3     010E    20 05               BRA WAIT_VIDEO_CHIP_B3
    195        0110                    BACKGROUND_COLOR
    196  2     0110    86 06               LDA #COLOR_BG
    197  5     0112    B7 0806             STA REG1
    198
    199        0115                    WAIT_VIDEO_CHIP_B3                  * WAIT_EF9365_READY();
    200  4     0115    96 00               LDA $F000
    201  2     0117    84 04               ANDA #4
    202  3     0119    27 FA               BEQ WAIT_VIDEO_CHIP_B3
    203
    204  5     011B    B6 0805             LDA REG0
    205  4     011E    97 05               STA $F005
    206  5     0120    B6 0806             LDA REG1
    207  4     0123    97 10               STA $F010
    208  2     0125    86 11               LDA #$11
    209  4     0127    97 00               STA $F000
    210
    211  7     0129    7A 0801             DEC NB_VECTORS
    212  3     012C    26 AB               BNE DRAW_LINE_LOOP
    213
    214  7     012E    7A 0802             DEC SCAN_LINE
    215  2     0131    5A                  DECB
    216
    217  6     0132  1026 FF8B             LBNE DRAW_BITMAP_LOOP
    218
    219  5     0136    39                  RTS
    220
    221                                ********************************************************************************
    222
    223        0137                    BITMAP
    224        0137   4D 07 CA C6          FCB $4D,$07,$CA,$C6,$CD,$C1,$C3,$CB,$87,$07,$CA,$C6,$CD,$C1,$C3,$CB
               013B   CD C1 C3 CB
               013F   87 07 CA C6
               0143   CD C1 C3 CB
    225        0147   87 07 CA C6      	FCB $87,$07,$CA,$C6,$CD,$C1,$C3,$CB,$87,$07,$CA,$C6,$CD,$C1,$C3,$CB
               014B   CD C1 C3 CB
               014F   87 07 CA C6
               0153   CD C1 C3 CB
    226        0157   87 07 CA C6      	FCB $87,$07,$CA,$C6,$CD,$C1,$C3,$CB,$87,$07,$CA,$C6,$CD,$C7,$C3,$CB
               015B   CD C1 C3 CB
               015F   87 07 CA C6
               0163   CD C7 C3 CB
    227        0167   87 07 CA C6      	FCB $87,$07,$CA,$C6,$CD,$C7,$C3,$CB,$87,$07,$CA,$C6,$CD,$C7,$C3,$CB
               016B   CD C7 C3 CB
               016F   87 07 CA C6
               0173   CD C7 C3 CB
    228        0177   87 07 CA C6      	FCB $87,$07,$CA,$C6,$CD,$C7,$C3,$CB,$87,$05,$CA,$C6,$07,$24,$CB,$87
               017B   CD C7 C3 CB
               017F   87 05 CA C6
               0183   07 24 CB 87
    229        0187   05 CA C6 07      	FCB $05,$CA,$C6,$07,$24,$CB,$87,$05,$CA,$C6,$07,$24,$CB,$87,$05,$CA
               018B   24 CB 87 05
               018F   CA C6 07 24
               0193   CB 87 05 CA
    230        0197   C6 07 24 CB      	FCB $C6,$07,$24,$CB,$87,$02,$CA,$07,$44,$02,$CA,$07,$44,$02,$CA,$07
               019B   87 02 CA 07
               019F   44 02 CA 07
               01A3   44 02 CA 07
    231        01A7   44 02 CA 07      	FCB $44,$02,$CA,$07,$44,$02,$CA,$07,$44,$01,$07,$50,$01,$07,$50,$01
               01AB   44 02 CA 07
               01AF   44 01 07 50
               01B3   01 07 50 01
    232        01B7   07 50 01 07      	FCB $07,$50,$01,$07,$50,$01,$07,$50,$01,$07,$50,$01,$07,$50,$01,$07
               01BB   50 01 07 50
               01BF   01 07 50 01
               01C3   07 50 01 07
    233        01C7   50 01 07 50      	FCB $50,$01,$07,$50,$01,$07,$50,$01,$07,$50,$01,$07,$50,$03,$07,$25
               01CB   01 07 50 01
               01CF   07 50 01 07
               01D3   50 03 07 25
    234        01D7   20 07 29 03      	FCB $20,$07,$29,$03,$07,$24,$40,$07,$28,$03,$07,$24,$40,$07,$28,$03
               01DB   07 24 40 07
               01DF   28 03 07 24
               01E3   40 07 28 03
    235        01E7   07 24 40 07      	FCB $07,$24,$40,$07,$28,$03,$07,$25,$30,$07,$28,$05,$07,$24,$40,$07
               01EB   28 03 07 25
               01EF   30 07 28 05
               01F3   07 24 40 07
    236        01F7   18 30 D7 05      	FCB $18,$30,$D7,$05,$07,$24,$50,$07,$16,$40,$D7,$05,$07,$23,$60,$07
               01FB   07 24 50 07
               01FF   16 40 D7 05
               0203   07 23 60 07
    237        0207   16 40 D7 05      	FCB $16,$40,$D7,$05,$07,$23,$70,$07,$15,$40,$D7,$05,$07,$23,$70,$07
               020B   07 23 70 07
               020F   15 40 D7 05
               0213   07 23 70 07
    238        0217   15 50 C7 05      	FCB $15,$50,$C7,$05,$07,$23,$70,$07,$15,$50,$C7,$05,$07,$23,$60,$07
               021B   07 23 70 07
               021F   15 50 C7 05
               0223   07 23 60 07
    239        0227   16 50 C7 07      	FCB $16,$50,$C7,$07,$07,$12,$40,$C7,$70,$07,$15,$60,$C7,$09,$27,$40
               022B   07 12 40 C7
               022F   70 07 15 60
               0233   C7 09 27 40
    240        0237   A7 70 A7 80      	FCB $A7,$70,$A7,$80,$07,$10,$B0,$C7,$09,$17,$60,$87,$A0,$77,$90,$C7
               023B   07 10 B0 C7
               023F   09 17 60 87
               0243   A0 77 90 C7
    241        0247   00 10 B7 09      	FCB $00,$10,$B7,$09,$17,$60,$87,$B0,$47,$B0,$A7,$00,$12,$B7,$09,$27
               024B   17 60 87 B0
               024F   47 B0 A7 00
               0253   12 B7 09 27
    242        0257   50 87 C0 27      	FCB $50,$87,$C0,$27,$B0,$A7,$00,$13,$B7,$09,$27,$50,$87,$C0,$17,$B0
               025B   B0 A7 00 13
               025F   B7 09 27 50
               0263   87 C0 17 B0
    243        0267   A7 00 13 C7      	FCB $A7,$00,$13,$C7,$07,$17,$60,$87,$00,$18,$97,$00,$10,$07,$10,$07
               026B   07 17 60 87
               026F   00 18 97 00
               0273   10 07 10 07
    244        0277   27 50 87 00      	FCB $27,$50,$87,$00,$17,$97,$00,$10,$07,$11,$07,$27,$60,$87,$00,$17
               027B   17 97 00 10
               027F   07 11 07 27
               0283   60 87 00 17
    245        0287   87 D0 07 14      	FCB $87,$D0,$07,$14,$07,$47,$50,$87,$00,$16,$77,$D0,$07,$15,$07,$57
               028B   07 47 50 87
               028F   00 16 77 D0
               0293   07 15 07 57
    246        0297   50 87 00 16      	FCB $50,$87,$00,$16,$67,$B0,$07,$17,$07,$67,$50,$87,$00,$15,$57,$B0
               029B   67 B0 07 17
               029F   07 67 50 87
               02A3   00 15 57 B0
    247        02A7   07 18 07 67      	FCB $07,$18,$07,$67,$60,$87,$00,$15,$47,$A0,$07,$19,$07,$67,$70,$67
               02AB   60 87 00 15
               02AF   47 A0 07 19
               02B3   07 67 70 67
    248        02B7   00 17 37 A0      	FCB $00,$17,$37,$A0,$07,$19,$07,$77,$60,$47,$00,$1A,$27,$90,$07,$1A
               02BB   07 19 07 77
               02BF   60 47 00 1A
               02C3   27 90 07 1A
    249        02C7   03 87 00 2D      	FCB $03,$87,$00,$2D,$07,$1B,$05,$97,$00,$2D,$17,$70,$07,$12,$03,$A7
               02CB   07 1B 05 97
               02CF   00 2D 17 70
               02D3   07 12 03 A7
    250        02D7   00 36 07 10      	FCB $00,$36,$07,$10,$03,$A7,$00,$37,$F7,$03,$A7,$00,$38,$E7,$03,$B7
               02DB   03 A7 00 37
               02DF   F7 03 A7 00
               02E3   38 E7 03 B7
    251        02E7   00 37 E7 05      	FCB $00,$37,$E7,$05,$C7,$90,$57,$00,$29,$D7,$03,$07,$1C,$00,$28,$C7
               02EB   C7 90 57 00
               02EF   29 D7 03 07
               02F3   1C 00 28 C7
    252        02F7   03 07 1D 00      	FCB $03,$07,$1D,$00,$28,$B7,$05,$07,$1E,$00,$1D,$17,$A0,$A7,$05,$07
               02FB   28 B7 05 07
               02FF   1E 00 1D 17
               0303   A0 A7 05 07
    253        0307   1F 00 1A 47      	FCB $1F,$00,$1A,$47,$90,$A7,$05,$07,$20,$00,$18,$67,$90,$97,$05,$07
               030B   90 A7 05 07
               030F   20 00 18 67
               0313   90 97 05 07
    254        0317   21 00 15 97      	FCB $21,$00,$15,$97,$90,$87,$07,$07,$22,$00,$13,$B7,$90,$27,$10,$47
               031B   90 87 07 07
               031F   22 00 13 B7
               0323   90 27 10 47
    255        0327   04 07 23 00      	FCB $04,$07,$23,$00,$11,$D7,$F0,$04,$07,$24,$F0,$07,$10,$D0,$04,$07
               032B   11 D7 F0 04
               032F   07 24 F0 07
               0333   10 D0 04 07
    256        0337   24 E0 07 12      	FCB $24,$E0,$07,$12,$C0,$07,$07,$26,$10,$27,$80,$07,$14,$A0,$17,$05
               033B   C0 07 07 26
               033F   10 27 80 07
               0343   14 A0 17 05
    257        0347   07 2B 40 07      	FCB $07,$2B,$40,$07,$17,$60,$47,$03,$07,$46,$40,$67
               034B   17 60 47 03
               034F   07 46 40 67

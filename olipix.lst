Pass1
Pass2
      1                        0319    LINE_COUNTER2 EQU $0319
      2                        0006    COLOR_BG    EQU $6
      3
      4                        0800    NB_LINES    EQU $800
      5                        0801    NB_VECTORS  EQU $801
      6                        0802    SCAN_LINE   EQU $802
      7                        0803    COLOR       EQU $803
      8                        0804    CNT         EQU $804
      9                        0805    REG0        EQU $805
     10                        0806    REG1        EQU $806
     11                        0807    TOP_LINE    EQU $807
     12                        0808    LINE_COUNTER EQU $808
     13                        0809    DX          EQU $809
     14                        080A    X_START     EQU $80A
     15                        080B    CMD         EQU $80B
     16
     17        0000                        ORG $0000
     18
     19        0000                    WAIT_VIDEO_CHIP
     20  5     0000    B6 F000             LDA $F000
     21  2     0003    84 04               ANDA #4
     22  3     0005    27 F9               BEQ WAIT_VIDEO_CHIP
     23
     24  7     0007    7F F010             CLR $F010
     25
     26        000A                    WAIT_VIDEO_CHIP2
     27  5     000A    B6 F000             LDA $F000
     28  2     000D    84 04               ANDA #4
     29  3     000F    27 F9               BEQ WAIT_VIDEO_CHIP2
     30
     31  7     0011    8D 46               BSR CLEAR_SCREEN
     32  2     0013    C6 20               LDB #$20
     33  7     0015    8D 52               BSR DRAW_BACKGROUND_LINE
     34  2     0017    C6 50               LDB #$50
     35  7     0019    8D 4E               BSR DRAW_BACKGROUND_LINE
     36  2     001B    C6 70               LDB #$70
     37  7     001D    8D 4A               BSR DRAW_BACKGROUND_LINE
     38  2     001F    C6 80               LDB #$80
     39  7     0021    8D 46               BSR DRAW_BACKGROUND_LINE
     40
     41  2     0023    86 59               LDA #89
     42  5     0025    B7 080A             STA X_START
     43  2     0028    86 17               LDA #$17
     44  5     002A    B7 080B             STA CMD
     45  8     002D    BD 008F             JSR DRAW_BACKGROUND_LINE2
     46
     47  2     0030    86 AB               LDA #171
     48  5     0032    B7 080A             STA X_START
     49  2     0035    86 15               LDA #$15
     50  5     0037    B7 080B             STA CMD
     51  7     003A    8D 53               BSR DRAW_BACKGROUND_LINE2
     52
     53  2     003C    86 FF               LDA #$FF
     54  5     003E    B7 0807             STA TOP_LINE
     55  2     0041    86 90               LDA #$90
     56  5     0043    B7 0808             STA LINE_COUNTER
     57
     58        0046                    DEBUT
     59  8     0046    BD 00BB             JSR DRAW_BITMAP
     60  7     0049    7A 0807             DEC TOP_LINE
     61  7     004C    7A 0808             DEC LINE_COUNTER
     62  7     004F    7A 0807             DEC TOP_LINE
     63  7     0052    7A 0808             DEC LINE_COUNTER
     64  3     0055    26 EF               BNE DEBUT
     65
     66        0057                    END_PRG
     67  3     0057    20 FE               BRA END_PRG
     68
     69                                ********************************************************************************
     70
     71        0059                    CLEAR_SCREEN
     72        0059                    WAIT_VIDEO_CHIP_CS                  * WAIT_EF9365_READY();
     73  5     0059    B6 F000             LDA $F000
     74  2     005C    84 04               ANDA #4
     75  3     005E    27 F9               BEQ WAIT_VIDEO_CHIP_CS
     76
     77  2     0060    C6 04               LDB #$4
     78  4     0062  108E F000             LDY #$F000
     79  4+0   0066    E7 A4           	STB ,Y
     80  5     0068    39                  RTS
     81
     82                                ********************************************************************************
     83
     84        0069                    DRAW_BACKGROUND_LINE
     85        0069                    WAIT_VIDEO_CHIP_BG1                  * WAIT_EF9365_READY();
     86  5     0069    B6 F000             LDA $F000
     87  2     006C    84 04               ANDA #4
     88  3     006E    27 F9               BEQ WAIT_VIDEO_CHIP_BG1
     89
     90  7     0070    7F F008             CLR $F008   * ? = 0
     91  7     0073    7F F009             CLR $F009   * X = 0
     92  7     0076    7F F00A             CLR $F00A   * ? = 0
     93  5     0079    F7 F00B             STB $F00B   * Y = B
     94  2     007C    86 FF               LDA #$FF
     95  5     007E    B7 F005             STA $F005   * dX = 255
     96  2     0081    86 06               LDA #COLOR_BG
     97  5     0083    B7 F010             STA $F010   * color
     98  7     0086    7F F007             CLR $F007   * dY = 0
     99  2     0089    86 11               LDA #$11
    100  5     008B    B7 F000             STA $F000   * CMD = draw_line
    101  5     008E    39                  RTS
    102
    103                                ********************************************************************************
    104
    105        008F                    DRAW_BACKGROUND_LINE2
    106        008F                    WAIT_VIDEO_CHIP_BG2                  * WAIT_EF9365_READY();
    107  5     008F    B6 F000             LDA $F000
    108  2     0092    84 04               ANDA #4
    109  3     0094    27 F9               BEQ WAIT_VIDEO_CHIP_BG2
    110
    111  5     0096    B6 080A             LDA X_START
    112  5     0099    B7 F009             STA $F009   * X = X_START
    113  7     009C    7F F008             CLR $F008   * ? = 0
    114  7     009F    7F F00A             CLR $F00A   * ? = 0
    115  5     00A2    F7 F00B             STB $F00B   * Y = B
    116  2     00A5    86 1E               LDA #30
    117  5     00A7    B7 F005             STA $F005   * dX
    118  2     00AA    86 06               LDA #COLOR_BG
    119  5     00AC    B7 F010             STA $F010   * color
    120  2     00AF    86 80               LDA #$80
    121  5     00B1    B7 F007             STA $F007   * dY
    122  5     00B4    B6 080B             LDA CMD
    123  5     00B7    B7 F000             STA $F000   * CMD = draw_line
    124  5     00BA    39                  RTS
    125
    126                                ********************************************************************************
    127
    128        00BB                    DRAW_BITMAP
    129  3     00BB    8E 018B             LDX #BITMAP
    130
    131  4+0   00BE    E6 84               LDB ,X                      * i = nb_lines
    132  4+2   00C0    A6 80               LDA ,X+                    * nb_lines = *vectorized_sprite++;
    133  5     00C2    B7 0800             STA NB_LINES
    134
    135        00C5                    WAIT_VIDEO_CHIP_B1                  * WAIT_EF9365_READY();
    136  5     00C5    B6 F000             LDA $F000
    137  2     00C8    84 04               ANDA #4
    138  3     00CA    27 F9               BEQ WAIT_VIDEO_CHIP_B1
    139
    140  7     00CC    7F F007             CLR $F007                       * WR_BYTE(HW_EF9365 + 0x7, 0x00);
    141
    142  5     00CF    B6 0807             LDA TOP_LINE
    143  5     00D2    B7 0802             STA SCAN_LINE                   * regsbuf[1] = 100
    144
    145        00D5                    DRAW_BITMAP_LOOP
    146
    147        00D5                    WAIT_VIDEO_CHIP_B2                  * WAIT_EF9365_READY();
    148  5     00D5    B6 F000             LDA $F000
    149  2     00D8    84 04               ANDA #4
    150  3     00DA    27 F9               BEQ WAIT_VIDEO_CHIP_B2
    151
    152  7     00DC    7F F008             CLR $F008
    153  7     00DF    7F F00A             CLR $F00A
    154  2     00E2    86 5A               LDA #90
    155  5     00E4    B7 F009             STA $F009
    156  5     00E7    B6 0802             LDA SCAN_LINE
    157  5     00EA    B7 F00B             STA $F00B
    158
    159  4+2   00ED    A6 80               LDA ,X+                    * nb_vects = *vectorized_sprite++;
    160  5     00EF    B7 0801             STA NB_VECTORS
    161
    162        00F2                    DRAW_LINE_LOOP
    163  4+2   00F2    A6 80               LDA ,X+
    164  5     00F4    B7 0803             STA COLOR
    165  2     00F7    44                  LSRA
    166  2     00F8    44                  LSRA
    167  2     00F9    44                  LSRA
    168  2     00FA    44                  LSRA
    169  5     00FB    B7 0804             STA CNT
    170  2     00FE    81 00               CMPA #0
    171  3     0100    26 07               BNE DRAW_LINE1                  * if (cnt == NULL)
    172  4+2   0102    A6 80               LDA ,X+                    * regsbuf[0] = *vectorized_sprite++;
    173  5     0104    B7 0805             STA REG0
    174  3     0107    20 03               BRA DRAW_VECTOR
    175        0109                    DRAW_LINE1
    176  5     0109    B7 0805             STA REG0                        * regsbuf[0] = cnt;
    177        010C                    DRAW_VECTOR
    178  5     010C    B6 0803             LDA COLOR
    179  2     010F    84 0F               ANDA #$0F
    180  5     0111    B7 0806             STA REG1
    181  2     0114    81 07               CMPA #$07
    182  3     0116    26 16               BNE WAIT_VIDEO_CHIP_B3
    183  5     0118    B6 0802             LDA SCAN_LINE
    184  2     011B    81 50               CMPA #$50
    185  3     011D    27 0A               BEQ BACKGROUND_COLOR
    186  2     011F    81 70               CMPA #$70
    187  3     0121    27 06               BEQ BACKGROUND_COLOR
    188  2     0123    81 80               CMPA #$80
    189  3     0125    27 02               BEQ BACKGROUND_COLOR
    190  3     0127    20 05               BRA WAIT_VIDEO_CHIP_B3
    191        0129                    BACKGROUND_COLOR
    192  2     0129    86 06               LDA #COLOR_BG
    193  5     012B    B7 0806             STA REG1
    194
    195        012E                    WAIT_VIDEO_CHIP_B3                  * WAIT_EF9365_READY();
    196  5     012E    B6 F000             LDA $F000
    197  2     0131    84 04               ANDA #4
    198  3     0133    27 F9               BEQ WAIT_VIDEO_CHIP_B3
    199
    200  5     0135    B6 0805             LDA REG0
    201  5     0138    B7 F005             STA $F005
    202  5     013B    B6 0806             LDA REG1
    203  5     013E    B7 F010             STA $F010
    204  2     0141    86 11               LDA #$11
    205  5     0143    B7 F000             STA $F000
    206
    207  7     0146    7A 0801             DEC NB_VECTORS
    208  3     0149    26 A7               BNE DRAW_LINE_LOOP
    209
    210  7     014B    7A 0802             DEC SCAN_LINE
    211  2     014E    5A                  DECB
    212
    213  6     014F  1026 FF82             LBNE DRAW_BITMAP_LOOP
    214
    215  5     0153    39                  RTS
    216
    217                                ********************************************************************************
    218
    219        0154                    DISPLAY_TEXT
    220        0154                    WAIT_VIDEO_CHIP_TXT                  * WAIT_EF9365_READY();
    221  5     0154    B6 F000             LDA $F000
    222  2     0157    84 04               ANDA #4
    223  3     0159    27 F9               BEQ WAIT_VIDEO_CHIP_TXT
    224
    225  2     015B    86 06               LDA #$6
    226  5     015D    B7 F010             STA $F010
    227
    228  7     0160    7F F008             CLR $F008
    229  2     0163    86 40               LDA #$40
    230  5     0165    B7 F009             STA $F009
    231  7     0168    7F F00A             CLR $F00A
    232  5     016B    B6 0807             LDA TOP_LINE
    233  5     016E    B7 F00B             STA $F00B
    234
    235  5     0171    F7 F003             STB $F003
    236
    237  3     0174    8E 017F             LDX #LABEL
    238        0177                    TEXT_LOOP
    239  4+2   0177    A6 80               LDA ,X+
    240  5     0179    B7 F000             STA $F000
    241  3     017C    26 F9               BNE TEXT_LOOP
    242  5     017E    39                  RTS
    243
    244                                ********************************************************************************
    245        017F                    LABEL
    246        017F   48 45 4C 4C          FCN 'HELLO WORLD'
               0183   4F 20 57 4F
               0187   52 4C C4
    247        018A   00                   FCB 0
    248
    249        018B                    BITMAP
    250        018B   4D 07 CA C6          FCB $4D,$07,$CA,$C6,$CD,$C1,$C3,$CB,$87,$07,$CA,$C6,$CD,$C1,$C3,$CB
               018F   CD C1 C3 CB
               0193   87 07 CA C6
               0197   CD C1 C3 CB
    251        019B   87 07 CA C6      	FCB $87,$07,$CA,$C6,$CD,$C1,$C3,$CB,$87,$07,$CA,$C6,$CD,$C1,$C3,$CB
               019F   CD C1 C3 CB
               01A3   87 07 CA C6
               01A7   CD C1 C3 CB
    252        01AB   87 07 CA C6      	FCB $87,$07,$CA,$C6,$CD,$C1,$C3,$CB,$87,$07,$CA,$C6,$CD,$C7,$C3,$CB
               01AF   CD C1 C3 CB
               01B3   87 07 CA C6
               01B7   CD C7 C3 CB
    253        01BB   87 07 CA C6      	FCB $87,$07,$CA,$C6,$CD,$C7,$C3,$CB,$87,$07,$CA,$C6,$CD,$C7,$C3,$CB
               01BF   CD C7 C3 CB
               01C3   87 07 CA C6
               01C7   CD C7 C3 CB
    254        01CB   87 07 CA C6      	FCB $87,$07,$CA,$C6,$CD,$C7,$C3,$CB,$87,$05,$CA,$C6,$07,$24,$CB,$87
               01CF   CD C7 C3 CB
               01D3   87 05 CA C6
               01D7   07 24 CB 87
    255        01DB   05 CA C6 07      	FCB $05,$CA,$C6,$07,$24,$CB,$87,$05,$CA,$C6,$07,$24,$CB,$87,$05,$CA
               01DF   24 CB 87 05
               01E3   CA C6 07 24
               01E7   CB 87 05 CA
    256        01EB   C6 07 24 CB      	FCB $C6,$07,$24,$CB,$87,$02,$CA,$07,$44,$02,$CA,$07,$44,$02,$CA,$07
               01EF   87 02 CA 07
               01F3   44 02 CA 07
               01F7   44 02 CA 07
    257        01FB   44 02 CA 07      	FCB $44,$02,$CA,$07,$44,$02,$CA,$07,$44,$01,$07,$50,$01,$07,$50,$01
               01FF   44 02 CA 07
               0203   44 01 07 50
               0207   01 07 50 01
    258        020B   07 50 01 07      	FCB $07,$50,$01,$07,$50,$01,$07,$50,$01,$07,$50,$01,$07,$50,$01,$07
               020F   50 01 07 50
               0213   01 07 50 01
               0217   07 50 01 07
    259        021B   50 01 07 50      	FCB $50,$01,$07,$50,$01,$07,$50,$01,$07,$50,$01,$07,$50,$03,$07,$25
               021F   01 07 50 01
               0223   07 50 01 07
               0227   50 03 07 25
    260        022B   20 07 29 03      	FCB $20,$07,$29,$03,$07,$24,$40,$07,$28,$03,$07,$24,$40,$07,$28,$03
               022F   07 24 40 07
               0233   28 03 07 24
               0237   40 07 28 03
    261        023B   07 24 40 07      	FCB $07,$24,$40,$07,$28,$03,$07,$25,$30,$07,$28,$05,$07,$24,$40,$07
               023F   28 03 07 25
               0243   30 07 28 05
               0247   07 24 40 07
    262        024B   18 30 D7 05      	FCB $18,$30,$D7,$05,$07,$24,$50,$07,$16,$40,$D7,$05,$07,$23,$60,$07
               024F   07 24 50 07
               0253   16 40 D7 05
               0257   07 23 60 07
    263        025B   16 40 D7 05      	FCB $16,$40,$D7,$05,$07,$23,$70,$07,$15,$40,$D7,$05,$07,$23,$70,$07
               025F   07 23 70 07
               0263   15 40 D7 05
               0267   07 23 70 07
    264        026B   15 50 C7 05      	FCB $15,$50,$C7,$05,$07,$23,$70,$07,$15,$50,$C7,$05,$07,$23,$60,$07
               026F   07 23 70 07
               0273   15 50 C7 05
               0277   07 23 60 07
    265        027B   16 50 C7 07      	FCB $16,$50,$C7,$07,$07,$12,$40,$C7,$70,$07,$15,$60,$C7,$09,$27,$40
               027F   07 12 40 C7
               0283   70 07 15 60
               0287   C7 09 27 40
    266        028B   A7 70 A7 80      	FCB $A7,$70,$A7,$80,$07,$10,$B0,$C7,$09,$17,$60,$87,$A0,$77,$90,$C7
               028F   07 10 B0 C7
               0293   09 17 60 87
               0297   A0 77 90 C7
    267        029B   00 10 B7 09      	FCB $00,$10,$B7,$09,$17,$60,$87,$B0,$47,$B0,$A7,$00,$12,$B7,$09,$27
               029F   17 60 87 B0
               02A3   47 B0 A7 00
               02A7   12 B7 09 27
    268        02AB   50 87 C0 27      	FCB $50,$87,$C0,$27,$B0,$A7,$00,$13,$B7,$09,$27,$50,$87,$C0,$17,$B0
               02AF   B0 A7 00 13
               02B3   B7 09 27 50
               02B7   87 C0 17 B0
    269        02BB   A7 00 13 C7      	FCB $A7,$00,$13,$C7,$07,$17,$60,$87,$00,$18,$97,$00,$10,$07,$10,$07
               02BF   07 17 60 87
               02C3   00 18 97 00
               02C7   10 07 10 07
    270        02CB   27 50 87 00      	FCB $27,$50,$87,$00,$17,$97,$00,$10,$07,$11,$07,$27,$60,$87,$00,$17
               02CF   17 97 00 10
               02D3   07 11 07 27
               02D7   60 87 00 17
    271        02DB   87 D0 07 14      	FCB $87,$D0,$07,$14,$07,$47,$50,$87,$00,$16,$77,$D0,$07,$15,$07,$57
               02DF   07 47 50 87
               02E3   00 16 77 D0
               02E7   07 15 07 57
    272        02EB   50 87 00 16      	FCB $50,$87,$00,$16,$67,$B0,$07,$17,$07,$67,$50,$87,$00,$15,$57,$B0
               02EF   67 B0 07 17
               02F3   07 67 50 87
               02F7   00 15 57 B0
    273        02FB   07 18 07 67      	FCB $07,$18,$07,$67,$60,$87,$00,$15,$47,$A0,$07,$19,$07,$67,$70,$67
               02FF   60 87 00 15
               0303   47 A0 07 19
               0307   07 67 70 67
    274        030B   00 17 37 A0      	FCB $00,$17,$37,$A0,$07,$19,$07,$77,$60,$47,$00,$1A,$27,$90,$07,$1A
               030F   07 19 07 77
               0313   60 47 00 1A
               0317   27 90 07 1A
    275        031B   03 87 00 2D      	FCB $03,$87,$00,$2D,$07,$1B,$05,$97,$00,$2D,$17,$70,$07,$12,$03,$A7
               031F   07 1B 05 97
               0323   00 2D 17 70
               0327   07 12 03 A7
    276        032B   00 36 07 10      	FCB $00,$36,$07,$10,$03,$A7,$00,$37,$F7,$03,$A7,$00,$38,$E7,$03,$B7
               032F   03 A7 00 37
               0333   F7 03 A7 00
               0337   38 E7 03 B7
    277        033B   00 37 E7 05      	FCB $00,$37,$E7,$05,$C7,$90,$57,$00,$29,$D7,$03,$07,$1C,$00,$28,$C7
               033F   C7 90 57 00
               0343   29 D7 03 07
               0347   1C 00 28 C7
    278        034B   03 07 1D 00      	FCB $03,$07,$1D,$00,$28,$B7,$05,$07,$1E,$00,$1D,$17,$A0,$A7,$05,$07
               034F   28 B7 05 07
               0353   1E 00 1D 17
               0357   A0 A7 05 07
    279        035B   1F 00 1A 47      	FCB $1F,$00,$1A,$47,$90,$A7,$05,$07,$20,$00,$18,$67,$90,$97,$05,$07
               035F   90 A7 05 07
               0363   20 00 18 67
               0367   90 97 05 07
    280        036B   21 00 15 97      	FCB $21,$00,$15,$97,$90,$87,$07,$07,$22,$00,$13,$B7,$90,$27,$10,$47
               036F   90 87 07 07
               0373   22 00 13 B7
               0377   90 27 10 47
    281        037B   04 07 23 00      	FCB $04,$07,$23,$00,$11,$D7,$F0,$04,$07,$24,$F0,$07,$10,$D0,$04,$07
               037F   11 D7 F0 04
               0383   07 24 F0 07
               0387   10 D0 04 07
    282        038B   24 E0 07 12      	FCB $24,$E0,$07,$12,$C0,$07,$07,$26,$10,$27,$80,$07,$14,$A0,$17,$05
               038F   C0 07 07 26
               0393   10 27 80 07
               0397   14 A0 17 05
    283        039B   07 2B 40 07      	FCB $07,$2B,$40,$07,$17,$60,$47,$03,$07,$46,$40,$67
               039F   17 60 47 03
               03A3   07 46 40 67

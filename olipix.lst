Pass1
Pass2
      1                        0319    LINE_COUNTER2 EQU $0319
      2                        0006    COLOR_BG    EQU $6
      3
      4                        0800    NB_LINES    EQU $800
      5                        0801    NB_VECTORS  EQU $801
      6                        0802    SCAN_LINE   EQU $802
      7                        0803    COLOR       EQU $803
      8                        0804    CNT         EQU $804
      9                        0805    REG0        EQU $805
     10                        0806    REG1        EQU $806
     11                        0807    TOP_LINE    EQU $807
     12                        0808    LINE_COUNTER EQU $808
     13                        0809    DX          EQU $809
     14                        080A    X_START     EQU $80A
     15                        080B    CMD         EQU $80B
     16
     17        0000                        ORG $0000
     18
     19        0000                    WAIT_VIDEO_CHIP
     20  5     0000    B6 F000             LDA $F000
     21  2     0003    84 04               ANDA #4
     22  3     0005    27 F9               BEQ WAIT_VIDEO_CHIP
     23
     24  7     0007    7F F010             CLR $F010
     25
     26        000A                    WAIT_VIDEO_CHIP2
     27  5     000A    B6 F000             LDA $F000
     28  2     000D    84 04               ANDA #4
     29  3     000F    27 F9               BEQ WAIT_VIDEO_CHIP2
     30
     31  7     0011    8D 46               BSR CLEAR_SCREEN
     32  2     0013    C6 20               LDB #$20
     33  7     0015    8D 52               BSR DRAW_BACKGROUND_LINE
     34  2     0017    C6 50               LDB #$50
     35  7     0019    8D 4E               BSR DRAW_BACKGROUND_LINE
     36  2     001B    C6 70               LDB #$70
     37  7     001D    8D 4A               BSR DRAW_BACKGROUND_LINE
     38  2     001F    C6 80               LDB #$80
     39  7     0021    8D 46               BSR DRAW_BACKGROUND_LINE
     40
     41  2     0023    86 59               LDA #89
     42  5     0025    B7 080A             STA X_START
     43  2     0028    86 17               LDA #$17
     44  5     002A    B7 080B             STA CMD
     45  8     002D    BD 008F             JSR DRAW_BACKGROUND_LINE2
     46
     47  2     0030    86 AB               LDA #171
     48  5     0032    B7 080A             STA X_START
     49  2     0035    86 15               LDA #$15
     50  5     0037    B7 080B             STA CMD
     51  7     003A    8D 53               BSR DRAW_BACKGROUND_LINE2
     52
     53  2     003C    86 FF               LDA #$FF
     54  5     003E    B7 0807             STA TOP_LINE
     55  2     0041    86 90               LDA #$90
     56  5     0043    B7 0808             STA LINE_COUNTER
     57
     58        0046                    DEBUT
     59  8     0046    BD 00BB             JSR DRAW_BITMAP
     60  7     0049    7A 0807             DEC TOP_LINE
     61  7     004C    7A 0808             DEC LINE_COUNTER
     62  7     004F    7A 0807             DEC TOP_LINE
     63  7     0052    7A 0808             DEC LINE_COUNTER
     64  3     0055    26 EF               BNE DEBUT
     65
     66        0057                    END_PRG
     67  3     0057    20 FE               BRA END_PRG
     68
     69                                ********************************************************************************
     70
     71        0059                    CLEAR_SCREEN
     72        0059                    WAIT_VIDEO_CHIP_CS                  * WAIT_EF9365_READY();
     73  5     0059    B6 F000             LDA $F000
     74  2     005C    84 04               ANDA #4
     75  3     005E    27 F9               BEQ WAIT_VIDEO_CHIP_CS
     76
     77  2     0060    C6 04               LDB #$4
     78  4     0062  108E F000             LDY #$F000
     79  4+0   0066    E7 A4           	STB ,Y
     80  5     0068    39                  RTS
     81
     82                                ********************************************************************************
     83
     84        0069                    DRAW_BACKGROUND_LINE
     85        0069                    WAIT_VIDEO_CHIP_BG1                  * WAIT_EF9365_READY();
     86  5     0069    B6 F000             LDA $F000
     87  2     006C    84 04               ANDA #4
     88  3     006E    27 F9               BEQ WAIT_VIDEO_CHIP_BG1
     89
     90  7     0070    7F F008             CLR $F008   * ? = 0
     91  7     0073    7F F009             CLR $F009   * X = 0
     92  7     0076    7F F00A             CLR $F00A   * ? = 0
     93  5     0079    F7 F00B             STB $F00B   * Y = B
     94  2     007C    86 FF               LDA #$FF
     95  5     007E    B7 F005             STA $F005   * dX = 255
     96  2     0081    86 06               LDA #COLOR_BG
     97  5     0083    B7 F010             STA $F010   * color
     98  7     0086    7F F007             CLR $F007   * dY = 0
     99  2     0089    86 11               LDA #$11
    100  5     008B    B7 F000             STA $F000   * CMD = draw_line
    101  5     008E    39                  RTS
    102
    103                                ********************************************************************************
    104
    105        008F                    DRAW_BACKGROUND_LINE2
    106        008F                    WAIT_VIDEO_CHIP_BG2                  * WAIT_EF9365_READY();
    107  5     008F    B6 F000             LDA $F000
    108  2     0092    84 04               ANDA #4
    109  3     0094    27 F9               BEQ WAIT_VIDEO_CHIP_BG2
    110
    111  5     0096    B6 080A             LDA X_START
    112  5     0099    B7 F009             STA $F009   * X = X_START
    113  7     009C    7F F008             CLR $F008   * ? = 0
    114  7     009F    7F F00A             CLR $F00A   * ? = 0
    115  5     00A2    F7 F00B             STB $F00B   * Y = B
    116  2     00A5    86 1E               LDA #30
    117  5     00A7    B7 F005             STA $F005   * dX
    118  2     00AA    86 06               LDA #COLOR_BG
    119  5     00AC    B7 F010             STA $F010   * color
    120  2     00AF    86 80               LDA #$80
    121  5     00B1    B7 F007             STA $F007   * dY
    122  5     00B4    B6 080B             LDA CMD
    123  5     00B7    B7 F000             STA $F000   * CMD = draw_line
    124  5     00BA    39                  RTS
    125
    126                                ********************************************************************************
    127
    128        00BB                    DRAW_BITMAP
    129  3     00BB    8E 0154             LDX #BITMAP
    130
    131  4+0   00BE    E6 84               LDB ,X                      * i = nb_lines
    132  4+2   00C0    A6 80               LDA ,X+                    * nb_lines = *vectorized_sprite++;
    133  5     00C2    B7 0800             STA NB_LINES
    134
    135        00C5                    WAIT_VIDEO_CHIP_B1                  * WAIT_EF9365_READY();
    136  5     00C5    B6 F000             LDA $F000
    137  2     00C8    84 04               ANDA #4
    138  3     00CA    27 F9               BEQ WAIT_VIDEO_CHIP_B1
    139
    140  7     00CC    7F F007             CLR $F007                       * WR_BYTE(HW_EF9365 + 0x7, 0x00);
    141
    142  5     00CF    B6 0807             LDA TOP_LINE
    143  5     00D2    B7 0802             STA SCAN_LINE                   * regsbuf[1] = 100
    144
    145        00D5                    DRAW_BITMAP_LOOP
    146
    147        00D5                    WAIT_VIDEO_CHIP_B2                  * WAIT_EF9365_READY();
    148  5     00D5    B6 F000             LDA $F000
    149  2     00D8    84 04               ANDA #4
    150  3     00DA    27 F9               BEQ WAIT_VIDEO_CHIP_B2
    151
    152  7     00DC    7F F008             CLR $F008
    153  7     00DF    7F F00A             CLR $F00A
    154  2     00E2    86 5A               LDA #90
    155  5     00E4    B7 F009             STA $F009
    156  5     00E7    B6 0802             LDA SCAN_LINE
    157  5     00EA    B7 F00B             STA $F00B
    158
    159  4+2   00ED    A6 80               LDA ,X+                    * nb_vects = *vectorized_sprite++;
    160  5     00EF    B7 0801             STA NB_VECTORS
    161
    162        00F2                    DRAW_LINE_LOOP
    163  4+2   00F2    A6 80               LDA ,X+
    164  5     00F4    B7 0803             STA COLOR
    165  2     00F7    44                  LSRA
    166  2     00F8    44                  LSRA
    167  2     00F9    44                  LSRA
    168  2     00FA    44                  LSRA
    169  5     00FB    B7 0804             STA CNT
    170  2     00FE    81 00               CMPA #0
    171  3     0100    26 07               BNE DRAW_LINE1                  * if (cnt == NULL)
    172  4+2   0102    A6 80               LDA ,X+                    * regsbuf[0] = *vectorized_sprite++;
    173  5     0104    B7 0805             STA REG0
    174  3     0107    20 03               BRA DRAW_VECTOR
    175        0109                    DRAW_LINE1
    176  5     0109    B7 0805             STA REG0                        * regsbuf[0] = cnt;
    177        010C                    DRAW_VECTOR
    178  5     010C    B6 0803             LDA COLOR
    179  2     010F    84 0F               ANDA #$0F
    180  5     0111    B7 0806             STA REG1
    181  2     0114    81 07               CMPA #$07
    182  3     0116    26 16               BNE WAIT_VIDEO_CHIP_B3
    183  5     0118    B6 0802             LDA SCAN_LINE
    184  2     011B    81 50               CMPA #$50
    185  3     011D    27 0A               BEQ BACKGROUND_COLOR
    186  2     011F    81 70               CMPA #$70
    187  3     0121    27 06               BEQ BACKGROUND_COLOR
    188  2     0123    81 80               CMPA #$80
    189  3     0125    27 02               BEQ BACKGROUND_COLOR
    190  3     0127    20 05               BRA WAIT_VIDEO_CHIP_B3
    191        0129                    BACKGROUND_COLOR
    192  2     0129    86 06               LDA #COLOR_BG
    193  5     012B    B7 0806             STA REG1
    194
    195        012E                    WAIT_VIDEO_CHIP_B3                  * WAIT_EF9365_READY();
    196  5     012E    B6 F000             LDA $F000
    197  2     0131    84 04               ANDA #4
    198  3     0133    27 F9               BEQ WAIT_VIDEO_CHIP_B3
    199
    200  5     0135    B6 0805             LDA REG0
    201  5     0138    B7 F005             STA $F005
    202  5     013B    B6 0806             LDA REG1
    203  5     013E    B7 F010             STA $F010
    204  2     0141    86 11               LDA #$11
    205  5     0143    B7 F000             STA $F000
    206
    207  7     0146    7A 0801             DEC NB_VECTORS
    208  3     0149    26 A7               BNE DRAW_LINE_LOOP
    209
    210  7     014B    7A 0802             DEC SCAN_LINE
    211  2     014E    5A                  DECB
    212
    213  6     014F  1026 FF82             LBNE DRAW_BITMAP_LOOP
    214
    215  5     0153    39                  RTS
    216
    217                                ********************************************************************************
    218
    219        0154                    BITMAP
    220        0154   4D 07 CA C6          FCB $4D,$07,$CA,$C6,$CD,$C1,$C3,$CB,$87,$07,$CA,$C6,$CD,$C1,$C3,$CB
               0158   CD C1 C3 CB
               015C   87 07 CA C6
               0160   CD C1 C3 CB
    221        0164   87 07 CA C6      	FCB $87,$07,$CA,$C6,$CD,$C1,$C3,$CB,$87,$07,$CA,$C6,$CD,$C1,$C3,$CB
               0168   CD C1 C3 CB
               016C   87 07 CA C6
               0170   CD C1 C3 CB
    222        0174   87 07 CA C6      	FCB $87,$07,$CA,$C6,$CD,$C1,$C3,$CB,$87,$07,$CA,$C6,$CD,$C7,$C3,$CB
               0178   CD C1 C3 CB
               017C   87 07 CA C6
               0180   CD C7 C3 CB
    223        0184   87 07 CA C6      	FCB $87,$07,$CA,$C6,$CD,$C7,$C3,$CB,$87,$07,$CA,$C6,$CD,$C7,$C3,$CB
               0188   CD C7 C3 CB
               018C   87 07 CA C6
               0190   CD C7 C3 CB
    224        0194   87 07 CA C6      	FCB $87,$07,$CA,$C6,$CD,$C7,$C3,$CB,$87,$05,$CA,$C6,$07,$24,$CB,$87
               0198   CD C7 C3 CB
               019C   87 05 CA C6
               01A0   07 24 CB 87
    225        01A4   05 CA C6 07      	FCB $05,$CA,$C6,$07,$24,$CB,$87,$05,$CA,$C6,$07,$24,$CB,$87,$05,$CA
               01A8   24 CB 87 05
               01AC   CA C6 07 24
               01B0   CB 87 05 CA
    226        01B4   C6 07 24 CB      	FCB $C6,$07,$24,$CB,$87,$02,$CA,$07,$44,$02,$CA,$07,$44,$02,$CA,$07
               01B8   87 02 CA 07
               01BC   44 02 CA 07
               01C0   44 02 CA 07
    227        01C4   44 02 CA 07      	FCB $44,$02,$CA,$07,$44,$02,$CA,$07,$44,$01,$07,$50,$01,$07,$50,$01
               01C8   44 02 CA 07
               01CC   44 01 07 50
               01D0   01 07 50 01
    228        01D4   07 50 01 07      	FCB $07,$50,$01,$07,$50,$01,$07,$50,$01,$07,$50,$01,$07,$50,$01,$07
               01D8   50 01 07 50
               01DC   01 07 50 01
               01E0   07 50 01 07
    229        01E4   50 01 07 50      	FCB $50,$01,$07,$50,$01,$07,$50,$01,$07,$50,$01,$07,$50,$03,$07,$25
               01E8   01 07 50 01
               01EC   07 50 01 07
               01F0   50 03 07 25
    230        01F4   20 07 29 03      	FCB $20,$07,$29,$03,$07,$24,$40,$07,$28,$03,$07,$24,$40,$07,$28,$03
               01F8   07 24 40 07
               01FC   28 03 07 24
               0200   40 07 28 03
    231        0204   07 24 40 07      	FCB $07,$24,$40,$07,$28,$03,$07,$25,$30,$07,$28,$05,$07,$24,$40,$07
               0208   28 03 07 25
               020C   30 07 28 05
               0210   07 24 40 07
    232        0214   18 30 D7 05      	FCB $18,$30,$D7,$05,$07,$24,$50,$07,$16,$40,$D7,$05,$07,$23,$60,$07
               0218   07 24 50 07
               021C   16 40 D7 05
               0220   07 23 60 07
    233        0224   16 40 D7 05      	FCB $16,$40,$D7,$05,$07,$23,$70,$07,$15,$40,$D7,$05,$07,$23,$70,$07
               0228   07 23 70 07
               022C   15 40 D7 05
               0230   07 23 70 07
    234        0234   15 50 C7 05      	FCB $15,$50,$C7,$05,$07,$23,$70,$07,$15,$50,$C7,$05,$07,$23,$60,$07
               0238   07 23 70 07
               023C   15 50 C7 05
               0240   07 23 60 07
    235        0244   16 50 C7 07      	FCB $16,$50,$C7,$07,$07,$12,$40,$C7,$70,$07,$15,$60,$C7,$09,$27,$40
               0248   07 12 40 C7
               024C   70 07 15 60
               0250   C7 09 27 40
    236        0254   A7 70 A7 80      	FCB $A7,$70,$A7,$80,$07,$10,$B0,$C7,$09,$17,$60,$87,$A0,$77,$90,$C7
               0258   07 10 B0 C7
               025C   09 17 60 87
               0260   A0 77 90 C7
    237        0264   00 10 B7 09      	FCB $00,$10,$B7,$09,$17,$60,$87,$B0,$47,$B0,$A7,$00,$12,$B7,$09,$27
               0268   17 60 87 B0
               026C   47 B0 A7 00
               0270   12 B7 09 27
    238        0274   50 87 C0 27      	FCB $50,$87,$C0,$27,$B0,$A7,$00,$13,$B7,$09,$27,$50,$87,$C0,$17,$B0
               0278   B0 A7 00 13
               027C   B7 09 27 50
               0280   87 C0 17 B0
    239        0284   A7 00 13 C7      	FCB $A7,$00,$13,$C7,$07,$17,$60,$87,$00,$18,$97,$00,$10,$07,$10,$07
               0288   07 17 60 87
               028C   00 18 97 00
               0290   10 07 10 07
    240        0294   27 50 87 00      	FCB $27,$50,$87,$00,$17,$97,$00,$10,$07,$11,$07,$27,$60,$87,$00,$17
               0298   17 97 00 10
               029C   07 11 07 27
               02A0   60 87 00 17
    241        02A4   87 D0 07 14      	FCB $87,$D0,$07,$14,$07,$47,$50,$87,$00,$16,$77,$D0,$07,$15,$07,$57
               02A8   07 47 50 87
               02AC   00 16 77 D0
               02B0   07 15 07 57
    242        02B4   50 87 00 16      	FCB $50,$87,$00,$16,$67,$B0,$07,$17,$07,$67,$50,$87,$00,$15,$57,$B0
               02B8   67 B0 07 17
               02BC   07 67 50 87
               02C0   00 15 57 B0
    243        02C4   07 18 07 67      	FCB $07,$18,$07,$67,$60,$87,$00,$15,$47,$A0,$07,$19,$07,$67,$70,$67
               02C8   60 87 00 15
               02CC   47 A0 07 19
               02D0   07 67 70 67
    244        02D4   00 17 37 A0      	FCB $00,$17,$37,$A0,$07,$19,$07,$77,$60,$47,$00,$1A,$27,$90,$07,$1A
               02D8   07 19 07 77
               02DC   60 47 00 1A
               02E0   27 90 07 1A
    245        02E4   03 87 00 2D      	FCB $03,$87,$00,$2D,$07,$1B,$05,$97,$00,$2D,$17,$70,$07,$12,$03,$A7
               02E8   07 1B 05 97
               02EC   00 2D 17 70
               02F0   07 12 03 A7
    246        02F4   00 36 07 10      	FCB $00,$36,$07,$10,$03,$A7,$00,$37,$F7,$03,$A7,$00,$38,$E7,$03,$B7
               02F8   03 A7 00 37
               02FC   F7 03 A7 00
               0300   38 E7 03 B7
    247        0304   00 37 E7 05      	FCB $00,$37,$E7,$05,$C7,$90,$57,$00,$29,$D7,$03,$07,$1C,$00,$28,$C7
               0308   C7 90 57 00
               030C   29 D7 03 07
               0310   1C 00 28 C7
    248        0314   03 07 1D 00      	FCB $03,$07,$1D,$00,$28,$B7,$05,$07,$1E,$00,$1D,$17,$A0,$A7,$05,$07
               0318   28 B7 05 07
               031C   1E 00 1D 17
               0320   A0 A7 05 07
    249        0324   1F 00 1A 47      	FCB $1F,$00,$1A,$47,$90,$A7,$05,$07,$20,$00,$18,$67,$90,$97,$05,$07
               0328   90 A7 05 07
               032C   20 00 18 67
               0330   90 97 05 07
    250        0334   21 00 15 97      	FCB $21,$00,$15,$97,$90,$87,$07,$07,$22,$00,$13,$B7,$90,$27,$10,$47
               0338   90 87 07 07
               033C   22 00 13 B7
               0340   90 27 10 47
    251        0344   04 07 23 00      	FCB $04,$07,$23,$00,$11,$D7,$F0,$04,$07,$24,$F0,$07,$10,$D0,$04,$07
               0348   11 D7 F0 04
               034C   07 24 F0 07
               0350   10 D0 04 07
    252        0354   24 E0 07 12      	FCB $24,$E0,$07,$12,$C0,$07,$07,$26,$10,$27,$80,$07,$14,$A0,$17,$05
               0358   C0 07 07 26
               035C   10 27 80 07
               0360   14 A0 17 05
    253        0364   07 2B 40 07      	FCB $07,$2B,$40,$07,$17,$60,$47,$03,$07,$46,$40,$67
               0368   17 60 47 03
               036C   07 46 40 67
